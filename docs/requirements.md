# 需求文档

需求分三个部分，同样也是三个页面：向导、后台任务、仪表盘。

## 向导 wizard


> 1. **向导**：快速在腾讯云上通过抢占式服务器创建 kubernetes 集群。
>    1. 也可以不是抢占式服务器，主要取决于你的服务器模板。
>    2. 也可以不是腾讯云，可以添加其他服务商的接口。

向导逻辑如下：

1. 配置服务商，对于腾讯云，这里需要配置服务器地区和腾讯云用户密钥。
2. 选择template，需要用户自己先创建模板。
3. 配置ssh凭证，kube-node-pool将通过该凭证访问节点。
4. 创建服务器，kube-node-pool将创建服务器并通过 kubespray 创建k8s集群。

## 后台任务 background job


> 2. **后台服务**：检查服务器数量的，在云服务器被释放时创建新的节点加入集群。

后台任务逻辑如下：

1. 轮询检查：定期（如每 5 分钟）检查集群状态。
2. 节点数量对比：对比云服务商的实例数量与 kubernetes 集群的节点数量。
3. 异常处理：
   1. 当云服务器实例被回收时，从数据库中移除对应节点记录。
   2. 当 kubernetes 集群节点数量低于 `desiredNodeCount` 时，创建新的云服务器实例。
   3. 等待新服务器启动后，将其加入集群。
4. 日志记录：将每次轮询的结果记录到 `polling_records` 表，便于后续审计和故障排查。

## 仪表盘 dashboard


> 3. **仪表盘**：查看应用和节点池状态

仪表盘功能如下：

1. **集群概览**：显示所有集群的列表及其基本信息（名称、描述、期望节点数、实际节点数）。
2. **服务器池详情**：显示集群内每个服务器的详细信息（名称、IP、角色、创建时间、更新时间）。
3. **状态监控**：通过 kubernetes API 获取节点实时状态（Ready、NotReady 等），相当于`kubectl get nodes`
4. **操作入口**：提供向导和后台任务的快速访问入口。
